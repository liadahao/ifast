<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>全屏切换</title>
    <link th:href="@{/css/amazeui.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/page.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/plyr.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/front/workshop.css}" rel="stylesheet" type="text/css"/>
</head>
<style type="text/css">
    * {
        margin: 0;
        padding: 0;
    }

    html,
    body {
        width: 100%;
        height: 100%;
    }

    .page {
        height: 100%;
        width: 100%;
        font-size: 126px;
        display: -webkit-box;
        /*Safari*/
        display: -moz-box;
        /*Firefox*/
        display: -ms-flexbox;
        /*IE*/
        display: -webkit-flex;
        /*Chrome*/
        display: flex;
        -webkit-box-align: center;
        -moz-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        -webkit-box-pack: center;
        -moz-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
    }
</style>

<body>
<div th:replace="nav :: top-nav"></div>
<div id="mao">
    <div style="position: relative; left: 0px; top: -200%; width: 100%; height: 100%; visibility: visible;">
        <div class="page" style="background-color: transparent;" th:each="nav,navStat : ${navList}"
             th:id="|item-${navStat.count}|" th:attr="data-name=${nav.navname}">
            <iframe width="100%" height="100%" allowfullscreen th:src="${nav['url']}"></iframe>
        </div>
    </div>
</div>
<input type="hidden" th:value="${currentPage}" id="currentPage">
<!-- 侧边栏内容 -->
<div th:include="nav :: nav-side"></div>
<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/js/amazeui.min.js}"></script>
<script type="text/javascript" th:src="@{/js/plyr.js}"></script>
<script type="text/javascript">

    $(function ($) {
        $.fn.screen = function (options) {
            var $this = this;//第一个div
            var set = $.extend({
                before: [],
                after: []
            }, options);

            $this.css({
                overflow: 'hidden',
                position: 'fixed',
                width: '100%',
                height: '100%',
                left: '0',
                top: '0'
            });
            var secondDiv = $this.children('div');
            var ch = secondDiv.children('div');
            var navbarUl = $("<ul></ul>").css({
                position: 'absolute',
                top: '50%',
                "z-index": "1000",
                right: "1%"
            });

            var leftbarUl = $("<div class='left-nav'></div>").css({
                height: '768px',
                position: 'absolute',
                "z-index": "1000",
                top: '50%',
                left: "1%"
            });
            // var topText =
            var top = $('<div class="top"><a href="#"><img src="/img/up.png"/><div class="top-text">Home</div></a></div>');
            var bottomText = secondDiv.children().eq(1).attr('data-name');
            var bottom = $('<div class="bottom"><a href="#"><div class="bottom-text">' + bottomText + '</div><img src="/img/down.png"/></a></div>');
            top.appendTo(leftbarUl);
            bottom.appendTo(leftbarUl);
            ch.each(function (i) {
                var barele;
                if (i == 0) {
                    barele = $("<li></li>").attr("index", i).addClass("select-circular")
                } else {
                    barele = $("<li></li>").attr("index", i).addClass("circular")
                }
                barele.appendTo(navbarUl);
            });
            //console.log(navbarUl.height()); //打印0
            //先将其添加到HTML文档流对象中，再设置其top位置，不然其位置计算会忽略掉其自身高度。
            navbarUl.appendTo($this);
            leftbarUl.appendTo($this);
            //console.log(navbarUl.height()); //打印182高度
            navbarUl.css({
                "margin-top": -parseInt(navbarUl.height()) / 2 + "px"
            });
            leftbarUl.css({
                "margin-top": -parseInt(leftbarUl.height()) / 2 + "px"
            });
            var wheelName = navigator.userAgent.indexOf("Firefox") > 0 ? "DOMMouseScroll" : "mousewheel";

            $(document).on(wheelName, function () {
                var event = window.event || arguments.callee.caller.arguments[0];
                //console.log(event);
                var contentV = 0;
                //统一线下滚动为负数
                if (event.wheelDelta) {
                    contentV = Math.floor(event.wheelDelta / 120) * 60;

                } else if (event.detail) {
                    contentV = -Math.floor(event.detail / 3) * 60;
                }
                //console.log(contentV);
                if (contentV < 0) {
                    //向下滚动为1，向上滚动为-1
                    console.log("下滚动作");
                    slide(1);
                } else {
                    console.log("上滚动作");
                    slide(-1);
                }
            });

            var currentPage = 0;//当前的页数

            var lg = secondDiv.children("div").length;
            //var sht=_i.children('div').outerHeight();//得到屏内容的高度。也就是每次要切屏时div向上向下移动的量。
            var flag = true;

            //n是1就向下切屏，n是-1就向上切屏。
            function slide(n) {
                if (!flag) {

                    return;
                }
                flag = false;
                if (n > 0 && currentPage < (lg - 1)) {
                    console.log("执行下滚");
                    if (set.before[currentPage]) {
                        set.before[currentPage]();
                    }
                    currentPage++;
                    animateDown(currentPage);

                } else {
                    if (n < 0 && currentPage > 0) {
                        console.log("执行上滚")
                        if (set.before[currentPage]) {
                            set.before[currentPage]();
                        }
                        currentPage--;
                        animateDown(currentPage);
                    } else {
                        flag = true;
                    }
                }
            }

            function animateDown(c) {
                secondDiv.animate({top: -c * 100 + '%'}, 'normal', function () {
                    navbarUl.find('li').addClass("circular").removeClass("select-circular");
                    navbarUl.find('li').eq(c).addClass("select-circular").removeClass("circular");
                    if (c > 0) {
                        top.find(".top-text").text(secondDiv.children().eq(c - 1).attr('data-name'));
                    } else {
                        top.find(".top-text").text("Home");
                    }
                    if (c < lg - 1) {
                        bottom.show();
                        bottom.find(".bottom-text").text(secondDiv.children().eq(c + 1).attr('data-name'));
                    } else {
                        bottom.hide();
                    }
                    if (set.after[c]) {
                        set.after[c]();
                    }
                    flag = true;
                });
            }

            //初始化容器高度
            ch.height($(window).height());
            //窗口改变，容器高度也改变
            $(window).resize(function () {
                ch.height($(window).height());
            });

            navbarUl.children('li').on('click', function () {
                var $index = $(this).index();
                animateDown($index);
                currentPage = $index;
            });

            $(".am-offcanvas-content").children().on('click', function () {
                var $index = $(this).index();
                animateDown($index);
                currentPage = $index;
                $("#doc-oc-demo3").offCanvas("close");
            });

            top.on('click', function () {
                if (currentPage > 0) {
                    var $index = currentPage - 1;
                    animateDown($index);
                    currentPage = $index;
                } else {
                    window.location.href = "/index"
                }
            });

            bottom.on('click', function () {
                var $index = currentPage + 1;
                animateDown($index);
                currentPage = $index;
            });

            var $index = $("#currentPage").val();
            $index = parseInt($index);
            if ($index > 0) {
                animateDown($index);
                currentPage = $index;
            } else {
                animateDown(0);
                currentPage = $index;
            }
        }
    }(jQuery));


</script>
</body>

</html>
<script>
    //引用方法
    $(function () {
        $('#mao').screen();
        var id = '#doc-oc-demo3';
        var $myOc = $(id);
        $('.side-close').on('click', function () {
            $myOc.offCanvas($(this).data('rel'));
        });
    });
</script>